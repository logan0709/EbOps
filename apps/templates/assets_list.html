{% extends 'base.html' %}

{% block custom_head_css_js %}
<link rel="stylesheet" href="{{ url_for('static',filename='css/plugins/ztree/awesomeStyle/awesome.css') }}"/>
<script src="{{ url_for('static',filename='js/plugins/ztree/jquery.ztree.all.min.js') }}"></script>
<script src="{{ url_for('static',filename='js/jquery.form.min.js') }}"></script>
<style type="text/css">
    div#rMenu {
        position:absolute;
        visibility:hidden;
        text-align: left;
        top: 0;
        left: 0;
        z-index: 1000;

        padding: 0 0;
        margin: 2px 0 0;
        list-style: none;
        background-clip: padding-box;
     }
    .dataTables_wrapper .dataTables_processing {
        opacity: .9;
        border: none;
    }
    div#rMenu li{
        margin: 1px 0;
        cursor: pointer;
        list-style: none outside none;
     }
    .dropdown a:hover {
        background-color: #f1f1f1
    }
</style>
{% endblock %}


{% block content %}

<div class="wrapper wrapper-content">
   <div class="row">
       <div class="col-lg-3" id="split-left" style="padding-left: 3px">
           <div class="ibox float-e-margins">
               <div class="ibox-content mailbox-content" style="padding-top: 0;padding-left: 1px">
                   <div class="file-manager ">
                       <div>
                            <ul id="treeDemo" class="ztree"></ul>
                       </div>
                       <div class="clearfix"></div>
                   </div>
               </div>
           </div>
       </div>
       <div class="col-lg-9 animated fadeInRight" id="split-right">
           <div class="tree-toggle">
               <div class="btn btn-sm btn-primary tree-toggle-btn" onclick="toggle()">
                   <i class="fa fa-angle-left fa-x" id="toggle-icon"></i>
               </div>
           </div>



           <div class="mail-box-header">
               <div class="uc pull-left m-r-5">
                   <a class="btn btn-sm btn-primary" id="check_nodes" href="#"> 创建资产 </a>
               </div>

               <div class="" style="float: right">
                   <div class=" btn-group">
                        <button data-toggle="dropdown" class="btn btn-default btn-sm dropdown-toggle">Excel <span class="caret"></span></button>
                        <ul class="dropdown-menu">
                            <li>
                                <a class=" btn_export" tabindex="0">
                                <span>导出</span>
                                </a>
                            </li>
                            <li>
                                <a class=" btn_import" data-toggle="modal" data-target="#import_modal" tabindex="0">
                                <span>导入</span>
                                </a>
                            </li>
                            <li>
                                <a class=" btn_update" data-toggle="modal" data-target="#update_modal" tabindex="0">
                                <span>更新</span>
                                </a>
                            </li>
                        </ul>
                   </div>
               </div>

               <div id="asset_list_table_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
               <div id="uc" class="pull-left"></div>
               <div id="asset_list_table_filter" class="dataTables_filter"><label>搜索<input type="search" class="form-control input-sm" placeholder="" aria-controls="asset_list_table"></label></div>

               <table class="table table-striped table-bordered table-hover dataTable no-footer" id="asset_list_table" style="width: 100%;" role="grid">
               <thead>
                   <tr role="row">
                       <th class="text-center"><input type="checkbox" class="ipt_check_all"></th>
                       <th class="text-center">主机名</th>
                       <th class="text-center">IP</th>
                       <th class="text-center">设备类型</th>
                       <th class="text-center">机房</th>
                       <th class="text-center">机架</th>
                       <th class="text-center">动作</th></tr>
               </thead>
               <tbody id="hosts">
{#                    <tr role="row" class="odd">#}
{#                        <td class=" text-center"><input type="checkbox" class="text-center ipt_check" id=""></td>#}
{#                        <td class=" text-center"><a href="#">BEP171</a></td>#}
{#                        <td class="text-center">192.168.1.1</td>#}
{#                        <td class=" text-center">2019-04-30 14:44:12</td>#}
{#                        <td class=" text-center">#}
{#                            <a href="#" class="btn btn-xs btn-info">例检</a>#}
{#                            <a class="btn btn-xs btn-danger m-l-xs btn_asset_delete" data-uid="">删除</a>#}
{#                        </td>#}
{#                    </tr>#}


               </tbody>
               </table>
               <div id="asset_list_table_processing" class="dataTables_processing panel panel-default" style="display: none;">加载中 ...</div>
               <div class="row m-t">
                   <div class="col-md-8">
                       <div id="op" class="col-md-6">
                           <div class="input-group">
                               <select class="form-control m-b" style="width: auto" id="slct_bulk_update">
                                    <option value="delete">批量删除</option>
                                    <option value="update">批量更新</option>
                               </select>
                                <div class="input-group-btn pull-left" style="padding-left: 5px;">
                                    <button id="btn_bulk_update" style="height: 32px;" class="btn btn-sm btn-primary">提交</button>
                                </div>
                            </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>
   </div>
</div>


{% endblock %}
{% block custom_foot_js %}

<script type="text/javascript">

        function zTreeOnClick(event, treeId, treeNode) {
            $("#hosts").html("");
            document.getElementById("check_nodes").setAttribute('href',"/check/" + treeNode.name);
            $.ajax({
                url: "{{ url_for('assets.get_hosts') }}",
                type: 'POST',
                async: true,
                dataType: "json",
                data: {
                    cluster: treeNode.name
                },
                success: function (data) {
                    $.each(data, function (i, n) {
                        var tbBody = "";
                        var trColor;
                        if (i % 2 === 0) {
                            trColor = "even";
                        } else {
                            trColor = "odd";
                        }
                        tbBody += "<tr role=\"row\" class='" + trColor + "'>" + "<td class=\" text-center\">" +
                            "<input type=\"checkbox\" class=\"text-center ipt_check\" id=\"\"></td>\n" +
                            "<td class=\" text-center\"><a href=\"/assets/info/" + n.hostname + "\">" + n.hostname + "</a></td>\n" +
                            "<td class=\"text-center\">" + n.local_ip + "</td>\n<td class=\" text-center\">" + n.device_type +
                            "</td>\n" +
                            "<td class=\" text-center\">" + n.engine_room + "</td>\n" +
                            "<td class=\" text-center\">" + n.frame_number + "</td>\n" +
                            "<td class=\" text-center\">\n" +
                            "<a href=\"/assets/update/" + n.hostname + "\" class=\"btn btn-xs btn-info\">更新</a>\n" +
                            "<a class=\"btn btn-xs btn-danger m-l-xs btn_asset_delete\" data-uid=\"\">删除</a>\n" +
                            "</td>\n" +
                            "</tr>";
                        $("#hosts").append(tbBody);
                    })

                }
            });
        }

		var setting = {
            data: {
                simpleData: {
                    enable: false
                }
            },
            callback: {
                onClick: zTreeOnClick
            },
            async: {
                enable: true,
                contentType: "application/json",
                url: "{{url_for('assets.get_nodes')}}",  //获取数据的接口
                type:"get"
            }
        };



		$(document).ready(function(){
			$.fn.zTree.init($("#treeDemo"), setting);
		});
</script>
{% endblock %}